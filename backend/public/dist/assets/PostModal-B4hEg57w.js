import{u,a as h,b as g,d as j,e as b,D as f,f as y,j as e,g as o,C as N,r as m,h as p,m as x,L as v,i as w}from"./index-Cq1JYi_1.js";function E(s){const{isAuth:a}=u(),t=h(),{addToast:r}=g(),l=a?.id?{id:Number(a.id),role:a.role}:null,{mutate:n,isPending:c}=j({mutationFn:async i=>{const d=await b.post("",{query:f,variables:{id:i}});if(d.data.errors)throw new Error(d.data.errors[0].message);return i},onSuccess:()=>{r({message:"Post deleted",type:"success"}),t.invalidateQueries({queryKey:["timeline"]}),s()},onError:i=>r({message:i.message,type:"error"})});return{isPending:c,canDelete:l?.role==="ADMIN",delete:n}}function D({post:s,deleteMutation:a}){const t=y(),r=()=>t(`/edit/${s.id}`);return e.jsxs("div",{className:"flex gap-3 justify-center p-4",children:[e.jsx("button",{className:"btn btn-outline",onClick:r,"aria-label":"suggest edit",children:"Suggest Edit"}),a.canDelete&&e.jsx("button",{className:`btn btn-error ${a.isPending?"btn-disabled":""}`,onClick:()=>a.delete(Number(s.id)),"aria-label":"delete post",children:a.isPending?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading loading-spinner loading-md"}),"Deleting..."]}):"Delete Post"})]})}function k({post:s}){const a=o(Number(s.startYear),Number(s.startMonth),Number(s.startDay)),t=o(Number(s.endYear),Number(s.endMonth),Number(s.endDay)),r=!!s.imageUrl;return e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"card-title text-slate-300 text-xl sm:text-2xl mb-2 md:mb-4",children:s.name}),e.jsxs("div",{className:`grid ${r?"grid-cols-1 sm:grid-cols-2":"grid-cols-1"} gap-4`,children:[r&&e.jsxs("div",{className:"relative max-w-300 mx-auto h-full rounded",children:[e.jsx("a",{href:s.sourceUrl?s.sourceUrl:"",target:"_blank",rel:"noopener noreferrer",children:e.jsx("img",{src:s.imageUrl?s.imageUrl:"",alt:s.name,style:{maxHeight:"10rem"},className:"h-full object-cover justify-self-center rounded",loading:"lazy"})}),s.imageCredit&&e.jsxs("p",{className:"text-[10px] bg-black text-slate-400 pl-2 italic",children:["Image credit:"," ",e.jsx("a",{href:s.sourceUrl?s.sourceUrl:"",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-slate-300 truncate",children:s.imageCredit})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"grid grid-cols-[max-content_1fr] gap-x-2 gap-y-1 text-slate-300 text-md sm:text-lg pt-2",children:s.type==="person"?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold",children:"Born:"}),e.jsx("span",{children:a}),t&&t!=="0 CE"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold",children:"Died:"}),e.jsx("span",{children:t})]}),e.jsx("span",{className:"font-semibold",children:"Locale:"}),e.jsx("span",{children:s.country.name}),e.jsx("span",{className:"font-semibold",children:"Group:"}),e.jsx("span",{children:s.group?.name})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold",children:"From:"}),e.jsx("span",{children:a}),t&&t!=="0 CE"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold",children:"To:"}),e.jsx("span",{children:t})]}),e.jsx("span",{className:"font-semibold",children:"Locale: "}),e.jsx("span",{children:s.country.name}),s.group?.name&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold",children:"Group:"}),e.jsx("span",{children:s.group?.name})]})]})}),e.jsx("div",{className:"mt-4 items-start",children:e.jsx(N,{subjects:s.subjects})})]})]})]})}function P({post:s}){return e.jsxs("div",{className:"px-4 pb-4",children:[e.jsx("p",{className:"text-base md:text-lg text-slate-300 mb-2",children:s.startDescription}),s.endDescription&&e.jsx("p",{className:"italic text-sm md:text-lg text-slate-400",children:s.endDescription})]})}function F({open:s,post:a,onClose:t}){const r=document.getElementById("modal-root");m.useEffect(()=>(document.body.style.overflow=s?"hidden":"",()=>{document.body.style.overflow=""}),[s]),m.useEffect(()=>{const n=c=>c.key==="Escape"&&t();return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[t]);const l=E(t);return!s||!a||!r?null:p.createPortal(e.jsx(x.div,{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(x.div,{className:"w-full max-w-2xl bg-base-200 rounded-xl shadow-xl p-1 sm:p-6 relative m-4 max-h-[98vh] overflow-hidden",onClick:n=>n.stopPropagation(),initial:{scale:.85,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.85,opacity:0},transition:{duration:.25,ease:"easeOut"},children:e.jsxs("div",{className:"overflow-y-auto",children:[e.jsx("button",{className:"absolute top-3 right-3 text-gray-500 hover:text-gray-900 dark:hover:text-gray-300 text-xl",onClick:t,children:"âœ•"}),e.jsx(k,{post:a}),e.jsx(P,{post:a}),e.jsxs("div",{className:"flex overflow-y-auto my-1 items-center mt-auto",children:[e.jsxs("p",{className:"px-4 italic text-md text-slate-300",children:["by"," ",e.jsx(v,{to:`/user/${a.user.id}`,children:e.jsx("span",{className:"text-primary text-lg not-italic",children:a.user.username})})]}),e.jsx(w,{post:a})]}),e.jsx(D,{post:a,deleteMutation:l,onClose:t})]})})}),r)}export{F as default};
