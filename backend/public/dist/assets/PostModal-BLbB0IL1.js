import{u,a as h,b as g,d as j,e as b,D as f,f as N,j as e,g as d,C as y,r as o,m,L as p,h as v}from"./index-MLRpf55N.js";function w(s){const{isAuth:a}=u(),r=h(),{addToast:t}=g(),n=a?.id?{id:Number(a.id),role:a.role}:null,{mutate:l,isPending:x}=j({mutationFn:async i=>{const c=await b.post("",{query:f,variables:{id:i}});if(c.data.errors)throw new Error(c.data.errors[0].message);return i},onSuccess:()=>{t({message:"Post deleted",type:"success"}),r.invalidateQueries({queryKey:["timeline"]}),s()},onError:i=>t({message:i.message,type:"error"})});return{isPending:x,canDelete:n?.role==="ADMIN",delete:l}}function D({post:s,deleteMutation:a}){const r=N(),t=()=>r(`/edit/${s.id}`);return e.jsxs("div",{className:"flex gap-3 justify-center p-4",children:[e.jsx("button",{className:"btn btn-outline",onClick:t,"aria-label":"suggest edit",children:"Suggest Edit"}),a.canDelete&&e.jsx("button",{className:`btn btn-error ${a.isPending?"btn-disabled":""}`,onClick:()=>a.delete(Number(s.id)),"aria-label":"delete post",children:a.isPending?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading loading-spinner loading-md"}),"Deleting..."]}):"Delete Post"})]})}function E({post:s}){const a=d(Number(s.startYear),Number(s.startMonth),Number(s.startDay)),r=d(Number(s.endYear),Number(s.endMonth),Number(s.endDay)),t=!!s.imageUrl;return e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"card-title text-slate-300 text-xl sm:text-2xl mb-2 md:mb-4",children:s.name}),e.jsxs("div",{className:`grid ${t?"grid-cols-1 sm:grid-cols-2":"grid-cols-1"} gap-4`,children:[t&&e.jsxs("div",{className:"relative max-w-300 mx-auto h-full rounded",children:[e.jsx("a",{href:s.sourceUrl?s.sourceUrl:"",target:"_blank",rel:"noopener noreferrer",children:e.jsx("img",{src:s.imageUrl?s.imageUrl:"",alt:s.name,style:{maxHeight:"10rem"},className:"h-full object-cover justify-self-center rounded",loading:"lazy"})}),s.imageCredit&&e.jsxs("p",{className:"text-[10px] bg-black text-slate-400 pl-2 italic",children:["Image credit:"," ",e.jsx("a",{href:s.sourceUrl?s.sourceUrl:"",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-slate-300 truncate",children:s.imageCredit})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"grid grid-cols-[max-content_1fr] gap-x-2 gap-y-1 text-slate-300 text-md sm:text-lg pt-2",children:s.type==="person"?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold",children:"Born:"}),e.jsx("span",{children:a}),r&&r!=="0 CE"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold",children:"Died:"}),e.jsx("span",{children:r})]}),e.jsx("span",{className:"font-semibold",children:"Locale:"}),e.jsx("span",{children:s.country.name}),e.jsx("span",{className:"font-semibold",children:"Group:"}),e.jsx("span",{children:s.group?.name})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold",children:"From:"}),e.jsx("span",{children:a}),r&&r!=="0 CE"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold",children:"To:"}),e.jsx("span",{children:r})]}),e.jsx("span",{className:"font-semibold",children:"Locale: "}),e.jsx("span",{children:s.country.name}),s.group?.name&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold",children:"Group:"}),e.jsx("span",{children:s.group?.name})]})]})}),e.jsx("div",{className:"mt-4 items-start",children:e.jsx(y,{subjects:s.subjects})})]})]})]})}function k({post:s}){return e.jsxs("div",{className:"px-4 pb-4",children:[e.jsx("p",{className:"text-base md:text-lg text-slate-300 mb-2",children:s.startDescription}),s.endDescription&&e.jsx("p",{className:"italic text-sm md:text-lg text-slate-400",children:s.endDescription})]})}function F({open:s,post:a,onClose:r}){o.useEffect(()=>(document.body.style.overflow=s?"hidden":"",()=>{document.body.style.overflow=""}),[s]),o.useEffect(()=>{const n=l=>l.key==="Escape"&&r();return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[r]);const t=w(r);return!s||!a?null:e.jsx(m.div,{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:r,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(m.div,{className:"w-full max-w-2xl bg-base-200 rounded-xl shadow-xl p-1 sm:p-6 relative m-4 max-h-[98vh] overflow-hidden",onClick:n=>n.stopPropagation(),initial:{scale:.85,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.85,opacity:0},transition:{duration:.25,ease:"easeOut"},children:e.jsxs("div",{className:"overflow-y-auto",children:[e.jsx("button",{className:"absolute top-3 right-3 text-gray-500 hover:text-gray-900 dark:hover:text-gray-300 text-xl",onClick:r,children:"âœ•"}),e.jsx(E,{post:a}),e.jsx(k,{post:a}),e.jsxs("div",{className:"flex overflow-y-auto my-1 items-center mt-auto",children:[e.jsxs("p",{className:"px-4 italic text-md text-slate-300",children:["by"," ",e.jsx(p,{to:`/user/${a.user.id}`,children:e.jsx("span",{className:"text-primary text-lg not-italic",children:a.user.username})})]}),e.jsx(v,{post:a})]}),e.jsx(D,{post:a,deleteMutation:t,onClose:r})]})})})}export{F as default};
